# MangaCompass 簡略化フロー要件定義書
## 気分ベース一点推薦システム

### プロジェクト概要

現在のMangaCompassを、より直感的で素早いユーザー体験を提供する気分ベースの一点推薦システムに簡略化する。ユーザーの読書履歴と現在の気分から、最適な漫画を1つだけ推薦することで、選択疲労を軽減し、より強い推薦体験を提供する。

### 変更の背景と目的

#### 現在のフローの課題
- **複雑性**: 3ステップの設定プロセス
- **選択疲労**: 複数の推薦から選ぶ負担
- **時間コスト**: 完了まで3-5分必要
- **認知負荷**: ジャンルや詳細設定の理解が必要

#### 目指すユーザー体験
- **直感性**: 感情に基づく分かりやすい選択
- **スピード**: 1-2分で推薦完了
- **信頼性**: 1つの強い推薦による決断支援  
- **再利用性**: 気軽に何度でも使える

---

## フロー比較

### 現在のフロー
```
ランディング → 漫画選択(3-10作品) → ジャンル選択(1-8個) → 詳細設定 → 複数推薦表示
```

### 新しいフロー  
```
ランディング → 漫画選択(3-5作品) → 気分選択(8択) → 一点推薦 → アクション
```

---

## 気分ベース推薦システム仕様

### 気分カテゴリー定義

| 気分 | 英語名 | 説明 | 対応ジャンル | UI色 |
|------|--------|------|-------------|------|
| 🗡️ **冒険したい** | Adventure | 新しい世界を探検したい | Fantasy、Adventure、Sci-Fi | 青系 |
| 😌 **リラックスしたい** | Relax | 心穏やかに楽しみたい | Slice of Life、Comedy、軽Romance | 緑系 |
| 🔥 **熱くなりたい** | Excitement | エネルギッシュに楽しみたい | Action、Sports、Shonen | 赤系 |
| 💝 **感動したい** | Emotional | 心を動かされたい | Drama、Romance、Josei | ピンク系 |
| 🧠 **考えたい** | Thoughtful | 深く考えさせられたい | Mystery、Psychological、Seinen | 紫系 |
| ⚡ **スリルを味わいたい** | Thrilling | ドキドキハラハラしたい | Horror、Supernatural、Thriller | 黒系 |
| 🌟 **懐かしみたい** | Nostalgic | 名作や定番を読みたい | 高評価クラシック作品 | 金系 |
| 🎈 **軽く読みたい** | Light | さらっと気軽に楽しみたい | Comedy、4コマ、短編 | 黄系 |

### 推薦アルゴリズム

#### 重み付けシステム（新）
```
最終スコア = 基本適性(50%) + 気分マッチ(30%) + 評価(15%) + 新鮮度(5%)
```

- **基本適性**: 読書履歴からのジャンル/作者適性
- **気分マッチ**: 選択した気分との適合度
- **評価**: 作品の客観的評価
- **新鮮度**: 未読/話題性による調整

#### 気分マッピングルール

**冒険したい**
- Fantasy: 1.0、Adventure: 1.0、Sci-Fi: 0.9
- 長編・世界観重視作品を優先
- 評価4.0以上の壮大な作品

**リラックスしたい**  
- Slice of Life: 1.0、Comedy: 0.9、Romance(軽): 0.8
- 完結済み優先（安心して読める）
- 日常系・癒し系タグ重視

**熱くなりたい**
- Action: 1.0、Sports: 1.0、Shonen: 0.9
- 連載中作品優先（続きへの期待）
- バトル・競技要素重視

**感動したい**
- Drama: 1.0、Romance: 0.9、Josei: 0.8
- 高評価・感動タグ重視
- ヒューマンドラマ要素

**考えたい**
- Mystery: 1.0、Psychological: 1.0、Seinen: 0.9
- 複雑なストーリー構造
- 哲学的・心理的テーマ

**スリルを味わいたい**
- Horror: 1.0、Supernatural: 0.9、Thriller: 0.9
- サスペンス要素重視
- ダークファンタジー含む

**懐かしみたい**
- 評価4.5以上の名作優先
- 長期連載・完結済み
- クラシック・殿堂入り作品

**軽く読みたい**
- Comedy: 1.0、短編: 0.9
- 巻数少なめ優先
- 読みやすさ重視

---

## 機能要件

### オンボーディングフロー

#### Step 1: 読書履歴収集
- **表示作品数**: 20作品（ランダム表示）
- **選択範囲**: 最小3作品、最大5作品（簡略化）
- **UI**: 現在のカードUIを継続
- **時間目安**: 1-2分

#### Step 2: 気分選択
- **選択肢**: 8つの気分カテゴリー
- **UI**: 大きなカード形式、アイコン・色・説明文
- **必須選択**: 1つのみ選択
- **時間目安**: 30秒以内

### 推薦結果画面

#### 表示内容
- **推薦作品**: 1作品のみ大きく表示
- **推薦理由**: 気分と読書履歴に基づく説明
- **適合度**: パーセンテージ表示
- **作品詳細**: あらすじ、評価、巻数、状況
- **Amazonリンク**: アフィリエイトリンク

#### アクション
- **読んでみる**: Amazonページへ遷移
- **別の推薦を見る**: 同じ気分で再推薦
- **気分を変える**: 気分選択に戻る
- **最初から**: 読書履歴選択に戻る

### 追加機能

#### 推薦履歴
- **過去の推薦**: 直近10件の推薦を記録
- **簡単アクセス**: 「前回の推薦」ボタン

#### お気に入り機能
- **ブックマーク**: 推薦された作品を保存
- **読み終わった**: 読書履歴に追加

---

## 技術要件

### データ構造変更

#### 新しいユーザーデータモデル
```typescript
interface SimplifiedUser {
  id: string;
  readHistory: string[];      // 3-5作品に削減
  lastMood?: MoodType;        // 最後に選択した気分
  recommendationHistory: RecommendationRecord[]; // 推薦履歴
}

interface MoodType {
  id: 'adventure' | 'relax' | 'excitement' | 'emotional' | 
      'thoughtful' | 'thrilling' | 'nostalgic' | 'light';
  name: string;
  description: string;
  emoji: string;
}

interface RecommendationRecord {
  manga: Manga;
  mood: MoodType;
  score: number;
  reason: string;
  timestamp: Date;
  action?: 'viewed' | 'clicked' | 'bookmarked';
}
```

#### 推薦エンジン更新
```typescript
class MoodBasedRecommendationEngine {
  // 気分に基づく単一推薦生成
  generateSingleRecommendation(
    user: SimplifiedUser, 
    mood: MoodType
  ): RecommendationRecord

  // 気分とジャンルのマッピング
  getMoodGenreWeights(mood: MoodType): Record<string, number>
  
  // 新鮮度計算（過去の推薦と重複回避）
  calculateFreshnessScore(
    manga: Manga, 
    history: RecommendationRecord[]
  ): number
}
```

### API設計

#### エンドポイント（フロントエンドのみ）
```typescript
// LocalStorageベースのデータ管理
interface UserDataManager {
  saveReadingHistory(mangaIds: string[]): void
  getRecommendation(mood: MoodType): RecommendationRecord
  saveRecommendationAction(recordId: string, action: string): void
  getRecommendationHistory(): RecommendationRecord[]
}
```

### パフォーマンス要件

- **推薦生成時間**: 200ms以内
- **UI応答時間**: 100ms以内  
- **データサイズ**: localStorage 50KB以内
- **モバイル対応**: 完全レスポンシブ

---

## UI/UX要件

### デザイン方針

#### 気分選択画面
- **レイアウト**: 2x4グリッド（モバイル: 2x4）
- **カードサイズ**: 150x120px（PC）、120x100px（モバイル）
- **視覚的階層**: アイコン > タイトル > 説明文
- **ホバー効果**: 拡大・発光効果
- **選択状態**: 明確な視覚フィードバック

#### 推薦結果画面
- **ヒーロー表示**: 画面の70%を推薦作品が占有
- **画像サイズ**: 300x400px（PC）、200x300px（モバイル）
- **情報階層**: タイトル > 推薦理由 > 適合度 > 詳細情報
- **CTA配置**: 画面下部に大きなアクションボタン

### アニメーション

- **画面遷移**: 0.3秒のスライドアニメーション
- **推薦表示**: 1秒のフェードイン + スケール
- **ローディング**: 推薦生成中のスピナー表示
- **フィードバック**: ボタンクリック時の微細な動き

### アクセシビリティ

- **キーボード対応**: 全操作をキーボードで実行可能
- **スクリーンリーダー**: 適切なARIAラベル
- **色覚対応**: 色だけでなく形・テキストでも識別可能
- **フォントサイズ**: 最小14px、重要情報は16px以上

---

## 実装計画

### Phase 1: 基盤準備（1-2日）
- [ ] 新しいデータ構造の定義
- [ ] MoodBasedRecommendationEngineの実装  
- [ ] 気分カテゴリーとマッピングルールの実装
- [ ] LocalStorage管理機能の更新

### Phase 2: UI実装（2-3日）
- [ ] 気分選択画面のコンポーネント作成
- [ ] 推薦結果画面の大幅リニューアル
- [ ] アニメーション・遷移効果の実装
- [ ] モバイル対応の最適化

### Phase 3: 推薦ロジック（2日）
- [ ] 新しい推薦アルゴリズムの実装
- [ ] 気分マッピングの調整・最適化
- [ ] 推薦理由生成ロジックの更新
- [ ] テストデータでの動作確認

### Phase 4: 統合・テスト（1-2日）
- [ ] フロー全体の統合テスト
- [ ] ユーザビリティテスト
- [ ] パフォーマンス最適化
- [ ] バグ修正・調整

### Phase 5: デプロイ・検証（1日）
- [ ] 本番環境デプロイ
- [ ] 動作確認・監視
- [ ] フィードバック収集の準備

**総開発期間**: 6-10日

---

## メリット・デメリット

### メリット

#### ユーザー体験
- ✅ **簡単**: 2ステップで完了
- ✅ **直感的**: 感情ベースの分かりやすい選択
- ✅ **素早い**: 1-2分で推薦完了
- ✅ **決断支援**: 1つの推薦による明確な指針
- ✅ **再利用**: 気軽に何度でも使用可能

#### ビジネス価値  
- ✅ **コンバージョン向上**: 迷いが少なく行動に移しやすい
- ✅ **ユーザー定着**: 手軽さによる利用頻度向上
- ✅ **差別化**: 独特な気分ベースのアプローチ
- ✅ **バイラル性**: 「今の気分で推薦」は共有しやすい

#### 技術面
- ✅ **実装コスト削減**: シンプルなフロー
- ✅ **保守性向上**: 複雑な設定項目の削減
- ✅ **パフォーマンス**: 軽量なデータ構造

### デメリット・リスク

#### 推薦精度
- ⚠️ **選択肢制限**: 詳細な好み設定ができない
- ⚠️ **一点推薦リスク**: 外れた場合のインパクト大
- ⚠️ **多様性不足**: 同じ気分で似た推薦が続く可能性

#### ユーザーニーズ  
- ⚠️ **選択欲求**: 複数から選びたいユーザーの不満
- ⚠️ **詳細設定派**: 細かい設定を好むユーザーの離脱
- ⚠️ **気分表現**: 8択で表現しきれない感情

#### ビジネスリスク
- ⚠️ **アフィリエイト収益**: 推薦数減少による収益影響
- ⚠️ **セッション時間**: 滞在時間の短縮
- ⚠️ **データ収集**: ユーザー嗜好データの取得量減少

### リスク軽減策

1. **A/Bテスト**: 旧フローと新フローの並行運用
2. **フォールバック**: 「他の推薦も見る」オプション
3. **フィードバック収集**: 推薦の満足度調査
4. **段階的移行**: 一部ユーザーから段階的に展開

---

## 今後の拡張可能性

### 短期拡張（3-6ヶ月）
- **気分の学習**: 過去の選択パターンから気分を予測
- **時間帯連動**: 朝/昼/夜で気分選択肢を調整
- **季節連動**: 季節に応じた気分カテゴリーの追加
- **ソーシャル**: 「友達と同じ気分」機能

### 中期拡張（6-12ヶ月）
- **マルチ推薦**: 気分に応じて2-3作品を推薦
- **気分ミックス**: 複数の気分を組み合わせた推薦
- **コミュニティ**: 同じ気分のユーザー同士の交流
- **パーソナライゼーション**: 個人の気分パターン学習

### 長期ビジョン（1年以上）
- **AI対話**: 自然言語で気分を表現・推薦
- **感情分析**: テキスト/音声から気分を自動判定
- **VR/AR体験**: 没入感のある推薦体験
- **クロスメディア**: アニメ・小説・ゲームとの連携

---

## 成功指標（KPI）

### ユーザー行動指標
- **完了率**: オンボーディング完了率 > 80%
- **推薦クリック率**: Amazon遷移率 > 15%
- **リピート率**: 7日以内の再利用率 > 40%
- **セッション時間**: 平均セッション時間 < 3分

### ビジネス指標  
- **コンバージョン率**: アフィリエイトクリック率 > 12%
- **ユーザー満足度**: 推薦満足度 > 4.0/5.0
- **口コミ指標**: NPS（推奨度）> 50
- **継続利用**: 月次アクティブユーザー増加率 > 20%

### 技術指標
- **パフォーマンス**: ページロード時間 < 2秒
- **可用性**: アップタイム > 99.5%
- **エラー率**: JavaScriptエラー率 < 0.1%

---

## 結論

気分ベースの一点推薦システムは、現在のMangaCompassをより直感的で使いやすいサービスに進化させる可能性を秘めている。ユーザーの感情に寄り添った推薦体験により、従来の詳細設定型アプローチでは実現できない新しい価値を提供できる。

実装リスクは存在するが、段階的な移行とA/Bテストにより安全に検証可能。成功すれば、漫画推薦サービスの新しいスタンダードを確立し、競合他社との明確な差別化を実現できる。

**推奨アクション**: プロトタイプ開発による概念実証から開始し、ユーザーフィードバックを基に段階的に実装範囲を拡大する。