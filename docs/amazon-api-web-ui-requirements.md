# Amazon API連携 Web UI要件定義

## 1. 概要

### 1.1 目的
Amazon APIを活用した漫画データ管理システムにWebブラウザ上からアクセス可能なユーザーインターフェースを追加し、開発者が効率的にMangaCompassのモックデータを管理できるようにする。

### 1.2 前提条件
- 既存のPHPスクリプト（Amazon API連携）をベースとする
- ローカル開発環境での運用を想定
- 本番環境での公開は想定しない（セキュリティ考慮）

## 2. 機能要件

### 2.1 基本機能

#### 2.1.1 検索機能
- **Amazon検索フォーム**
  - キーワード検索（タイトル、著者名）
  - ASIN直接入力
  - ISBN-10/ISBN-13入力
  - 検索結果の一覧表示（カード形式）

#### 2.1.2 商品詳細表示
- Amazon商品情報の表示
  - 商品画像（サムネイル＋拡大表示）
  - タイトル、著者、価格
  - 商品説明
  - カテゴリー情報

#### 2.1.3 データ入力・編集フォーム
- **必須フィールド**
  - ID（自動生成＋手動編集可能）
  - タイトル（Amazon情報から自動入力＋編集可能）
  - 著者名（Amazon情報から自動入力＋編集可能）
  - ジャンル（複数選択、チェックボックス）
  - ステータス（ongoing/completed/hiatus）
  - 評価（1-10のスライダー）

- **任意フィールド**
  - 巻数（数値入力）
  - 説明文（テキストエリア）
  - 人気度（1-100のスライダー）
  - 発行年（年選択）

#### 2.1.4 プレビュー機能
- 入力データのJSONプレビュー
- TypeScript形式でのコード生成プレビュー
- Amazon商品画像の表示確認

#### 2.1.5 データ操作機能
- **追加機能**
  - mockData.tsへの新規エントリ追加
  - 重複チェック（ASIN、タイトルベース）
  - 一括追加（複数ASIN対応）

- **更新機能**
  - 既存エントリの検索・選択
  - フィールド単位での更新
  - 画像URL・リンクの更新

### 2.2 管理機能

#### 2.2.1 現在のデータ管理
- mockData.ts内容の一覧表示
- 検索・フィルタリング機能
- ページネーション（50件/ページ）

#### 2.2.2 バックアップ機能
- 変更前の自動バックアップ
- バックアップファイルの一覧・復元

#### 2.2.3 ログ表示
- API呼び出し履歴
- データ更新履歴
- エラーログ

## 3. UI/UX仕様

### 3.1 画面構成

#### 3.1.1 メイン画面レイアウト
```
┌─────────────────────────────────────────┐
│ MangaCompass Data Manager               │
├─────────────────────────────────────────┤
│ [検索] [現在のデータ] [ログ] [設定]      │
├─────────────────────────────────────────┤
│                                         │
│           メインコンテンツエリア         │
│                                         │
├─────────────────────────────────────────┤
│ ステータス: 最終更新 2024-01-15 14:30   │
└─────────────────────────────────────────┘
```

#### 3.1.2 検索画面
- 検索フォーム（上部固定）
- 検索結果カード（グリッドレイアウト）
- フィルタリングオプション（サイドバー）

#### 3.1.3 編集画面
- 左パネル: 商品情報表示
- 右パネル: 入力フォーム
- 下部: プレビュー・操作ボタン

### 3.2 デザインガイドライン
- **カラースキーム**: MangaCompassと同様の青色系
- **レスポンシブ対応**: デスクトップメイン、タブレット対応
- **アクセシビリティ**: キーボードナビゲーション対応

### 3.3 操作フロー

#### 3.3.1 新規追加フロー
1. 検索フォームで商品検索
2. 検索結果から対象商品を選択
3. データ入力フォームで詳細情報を編集
4. プレビューで確認
5. 追加実行 → 完了メッセージ

#### 3.3.2 更新フロー
1. 現在のデータから対象エントリを検索
2. 編集フォームで情報を修正
3. プレビューで確認
4. 更新実行 → 完了メッセージ

## 4. 技術仕様

### 4.1 追加技術要件
- **フロントエンド**
  - HTML5 + CSS3 + JavaScript（ES6+）
  - Bootstrap 5（UIフレームワーク）
  - jQuery（Ajax通信）
  - Chart.js（統計表示用）

- **バックエンド**
  - 既存PHPスクリプトの拡張
  - セッション管理
  - CSRF保護

### 4.2 ディレクトリ構造更新
```
scripts/amazon-api/
├── public/
│   ├── index.php           # メイン画面
│   ├── api/
│   │   ├── search.php      # Amazon検索API
│   │   ├── add.php         # データ追加API
│   │   ├── update.php      # データ更新API
│   │   └── list.php        # 現在データ取得API
│   ├── assets/
│   │   ├── css/
│   │   │   └── style.css
│   │   ├── js/
│   │   │   ├── main.js
│   │   │   └── manga-form.js
│   │   └── images/
│   └── templates/
│       ├── header.php
│       ├── footer.php
│       └── components/
├── src/
│   ├── WebUI/
│   │   ├── Controller.php
│   │   ├── ApiHandler.php
│   │   └── ViewRenderer.php
│   └── [既存のクラス]
```

### 4.3 API エンドポイント設計

#### 4.3.1 検索API
```
POST /api/search.php
Request: {
  "query": "Naruto",
  "type": "title|author|asin|isbn"
}
Response: {
  "success": true,
  "data": [商品情報の配列],
  "count": 10
}
```

#### 4.3.2 追加API
```
POST /api/add.php
Request: {
  "manga_data": {Mangaオブジェクト},
  "force": false
}
Response: {
  "success": true,
  "message": "データが正常に追加されました",
  "id": "new-manga-id"
}
```

## 5. セキュリティ要件

### 5.1 アクセス制御
- **Basic認証**
  - ユーザー名/パスワードによる基本認証
  - .htaccessによるディレクトリ保護

### 5.2 入力値検証
- XSS攻撃対策（HTMLエスケープ）
- SQLインジェクション対策（パラメータ化クエリ）
- CSRF攻撃対策（トークン検証）
- ファイルアップロード制限

### 5.3 エラーハンドリング
- 詳細なエラー情報の非表示
- ログファイルへの記録
- 適切なHTTPステータスコード返却

## 6. 運用要件

### 6.1 環境要件
- PHP 8.0以上
- Apache/Nginx
- 書き込み権限設定
- Amazon API認証情報

### 6.2 バックアップ
- 変更前の自動バックアップ
- 日次バックアップの自動生成
- バックアップ世代管理（7世代保持）

### 6.3 監視・ログ
- アクセスログ
- エラーログ
- API使用量監視
- パフォーマンス監視

## 7. 制約事項・リスク

### 7.1 制約事項
- ローカル環境での運用に限定
- 同時利用は想定しない（単一ユーザー）
- Amazon API制限に依存

### 7.2 リスク対策
- API制限時の適切なエラー表示
- データ破損時の復元手順
- 認証情報漏洩時の対応手順

## 8. 今後の拡張計画

### 8.1 第一段階（必須機能）
- 基本的な検索・追加機能
- シンプルなUI

### 8.2 第二段階（改善機能）
- バッチ処理機能
- 統計・分析機能
- 画像の自動ダウンロード

### 8.3 第三段階（高度な機能）
- 他のAPI連携
- 自動更新スケジューラー
- モバイル対応

## 9. 納品物

1. Web UI一式（HTML/CSS/JavaScript）
2. PHP APIエンドポイント
3. インストール・設定マニュアル
4. 使用方法ガイド
5. セキュリティ設定ガイド
6. トラブルシューティングガイド